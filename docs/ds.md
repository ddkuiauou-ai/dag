# DS (Downstream) í”„ë¡œì íŠ¸

## ê°œìš”

DS (Downstream) í”„ë¡œì íŠ¸ëŠ” ë„¤ì´ë²„ ì‡¼í•‘ ë¼ì´ë¸Œ í”Œë«í¼ì—ì„œ ë¼ì´ë¸Œ ì»¤ë¨¸ìŠ¤ ë°ì´í„°ë¥¼ í¬ë¡¤ë§í•˜ëŠ” ë° ì¤‘ì ì„ ë‘” ë°ì´í„° íŒŒì´í”„ë¼ì¸ì…ë‹ˆë‹¤. ë¼ì´ë¸Œ ì‡¼í•‘ ì´ë²¤íŠ¸ì— ëŒ€í•œ ì •ë³´ë¥¼ ì¶”ì¶œí•˜ê³ , ìˆ˜ì§‘ëœ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ë©°, ê²°ê³¼ë¥¼ í´ë¼ìš°ë“œ ê°ì²´ ìŠ¤í† ë¦¬ì§€(Cloudflare R2)ì— ì €ì¥í•©ë‹ˆë‹¤.

ì´ íŒŒì´í”„ë¼ì¸ì€ ì´ˆê¸° í¬ë¡¤ë§ ë‹¨ê³„ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ë‘ ê°€ì§€ ëŒ€ì•ˆì ì¸ ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. í•˜ë‚˜ëŠ” ë¡œì»¬ Node.js í™˜ê²½ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ê³  ë‹¤ë¥¸ í•˜ë‚˜ëŠ” Docker ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒìœ¼ë¡œ, ê°œë°œ ë° í”„ë¡œë•ì…˜ ì‹œë‚˜ë¦¬ì˜¤ ëª¨ë‘ì— ìœ ì—°í•˜ê²Œ ëŒ€ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ë° ìŠ¤ì¼€ì¤„ë§

### ì‘ì—… (Jobs)

DS íŒŒì´pelineì€ í¬ë¡¤ëŸ¬ì— ëŒ€í•œ ë‹¤ì–‘í•œ ì‹¤í–‰ ë°©ë²•ì— í•´ë‹¹í•˜ëŠ” ë‘ ê°€ì§€ ì£¼ìš” ì‘ì—…ì„ í†µí•´ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ë©ë‹ˆë‹¤.

-   **`ds_node_job`**: ì´ ì‘ì—…ì€ ë¡œì»¬ Node.js í™˜ê²½ì—ì„œ í¬ë¡¤ëŸ¬ë¥¼ ì‹¤í–‰í•˜ëŠ” `ds_img_r2_node` ì—ì…‹ìœ¼ë¡œ ì‹œì‘í•˜ì—¬ íŒŒì´í”„ë¼ì¸ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
-   **`ds_docker_job`**: ì´ ì‘ì—…ì€ ê´€ë¦¬ë˜ëŠ” Docker ì»¨í…Œiner ë‚´ì—ì„œ í¬ë¡¤ëŸ¬ë¥¼ ì‹¤í–‰í•˜ëŠ” `ds_img_r2_docker` ì—ì…‹ìœ¼ë¡œ ì‹œì‘í•˜ì—¬ íŒŒì´í”„ë¼ì¸ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.

ë‘ ì‘ì—… ëª¨ë‘ í¬ë¡¤ë§ ë‹¨ê³„ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ë©´ ë‹¤ìš´ìŠ¤íŠ¸ë¦¼ `ds_img_r2_processing` ì—ì…‹ì„ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤.

### ë¦¬ì†ŒìŠ¤ (Resources)

íŒŒì´í”„ë¼ì¸ì€ ëª‡ ê°€ì§€ ì£¼ìš” ë¦¬ì†ŒìŠ¤ì— ì˜ì¡´í•©ë‹ˆë‹¤.

-   **`DockerResource`**: `ds_img_r2_docker` ì—ì…‹ì´ í¬ë¡¤ëŸ¬ì˜ Docker ì»¨í…Œì´ë„ˆ ìˆ˜ëª… ì£¼ê¸°ë¥¼ ê´€ë¦¬í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
-   **`R2Resource`**: `ds_img_r2_processing` ì—ì…‹ì´ ì²˜ë¦¬ëœ ë°ì´í„°ë¥¼ ì—…ë¡œë“œí•˜ëŠ” ë° ì‚¬ìš©í•˜ëŠ” Cloudflare R2 ê°ì²´ ìŠ¤í† ë¦¬ì§€ì— ëŒ€í•œ ì—°ê²°ì„ ì œê³µí•˜ëŠ” ì‚¬ìš©ì ì§€ì • ë¦¬ì†ŒìŠ¤ì…ë‹ˆë‹¤.
-   **Node.js/Crawlee í™˜ê²½**: `ds_img_r2_node` ì—ì…‹ì€ `ds-naver-crawler` í”„ë¡œì íŠ¸ê°€ ì˜¬ë°”ë¥´ê²Œ êµ¬ì„±ëœ ë¡œì»¬ Node.js í™˜ê²½ì´ í•„ìš”í•©ë‹ˆë‹¤.

## ë°ì´í„° íë¦„ ë° ì—ì…‹ ì¢…ì†ì„±

ì´ í”„ë¡œì íŠ¸ëŠ” ë‹¨ì¼ ì²˜ë¦¬ ì—ì…‹ìœ¼ë¡œ ìˆ˜ë ´ë˜ëŠ” ë‘ ê°œì˜ ê°€ëŠ¥í•œ ì‹œì‘ì ì„ ê°€ì§„ Bronze-to-Silver íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.

```mermaid
graph TD
    subgraph "DS ê·¸ë£¹ (Bronze Tier)"
        A[ds_img_r2_docker] -- triggers --> C[ds_img_r2_processing <br> (Silver)];
        B[ds_img_r2_node] -- triggers --> C;
    end
```

### ì—ì…‹ ì„¸ë¶€ ì •ë³´

#### 1. `ds_img_r2_docker` / `ds_img_r2_node`
-   **í‹°ì–´**: Bronze
-   **ê·¸ë£¹**: DS
-   **ì—…ìŠ¤íŠ¸ë¦¼ ì¢…ì†ì„±**: ì—†ìŒ
-   **ì„¤ëª…**: ì´ ë‘ ì—ì…‹ì€ íŒŒì´pelineì˜ ëŒ€ì•ˆì ì¸ ì‹œì‘ì  ì—­í• ì„ í•©ë‹ˆë‹¤.
    -   `ds_img_r2_docker`: Docker ì»¨í…Œiner ë‚´ì—ì„œ `ds-naver-crawler`ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. ì´ëŠ” ì¼ë°˜ì ìœ¼ë¡œ í”„ë¡œë•ì…˜ ë˜ëŠ” ê²©ë¦¬ëœ í™˜ê²½ì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.
    -   `ds_img_r2_node`: ë¡œì»¬ Node.js í™˜ê²½ì—ì„œ `npm start`ë¥¼ ì‚¬ìš©í•˜ì—¬ `ds-naver-crawler`ë¥¼ ì§ì ‘ ì‹¤í–‰í•©ë‹ˆë‹¤. ì´ëŠ” ë¡œì»¬ ê°œë°œ ë° ë””ë²„ê¹…ì— ì í•©í•©ë‹ˆë‹¤.
-   **ì¶œë ¥**: ë‘ ì—ì…‹ ëª¨ë‘ í¬ë¡¤ëŸ¬ë¥¼ íŠ¸ë¦¬ê±°í•˜ì—¬ ìŠ¤í¬ë©ëœ ì›ì‹œ ë°ì´í„°ë¥¼ ë¡œì»¬ `storage/datasets` ë””ë ‰í† ë¦¬ì— JSON íŒŒì¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤.

#### 2. `ds_img_r2_processing`
-   **í‹°ì–´**: Silver
-   **ê·¸ë£¹**: DS
-   **ì—…ìŠ¤íŠ¸ë¦¼ ì¢…ì†ì„±**: `ds_img_r2_docker` ë˜ëŠ” `ds_img_r2_node`
-   **ì„¤ëª…**: ì´ ì—ì…‹ì€ í¬ë¡¤ë§ ë‹¨ê³„ê°€ ì™„ë£Œëœ í›„ í™œì„±í™”ë©ë‹ˆë‹¤. í¬ë¡¤ëŸ¬ê°€ ìƒì„±í•œ ìµœì‹  ë°ì´í„°ì…‹ ë””ë ‰í† ë¦¬ë¥¼ ì°¾ì•„ ì›ì‹œ JSON íŒŒì¼ì„ ì½ê³  í•„ìš”í•œ ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•œ ë‹¤ìŒ ìµœì¢… ê²°ê³¼ë¥¼ Cloudflare R2ì˜ ì§€ì •ëœ ë²„í‚·ì— ì—…ë¡œë“œí•©ë‹ˆë‹¤.
-   **ë¦¬ì†ŒìŠ¤**: `R2Resource`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

## ê°œë°œ ë° ë””ë²„ê¹…

### ğŸ”§ ìœ ìš©í•œ í™•ì¸ ëª…ë ¹ì–´

**DS ê·¸ë£¹ì˜ ì—ì…‹ ë‚˜ì—´:**

```bash
cd /Users/craigchoi/silla/dag

python -c "
from dag.definitions import defs
from dagster import AssetSelection

asset_graph = defs.get_asset_graph()
ds_assets = AssetSelection.groups('DS').resolve(asset_graph)
print('ğŸ¯ Assets in the \'DS\' group:')
for asset_key in ds_assets:
    print(f'  - {asset_key.to_user_string()}')
print(f'\nğŸ“Š Total {len(ds_assets)} assets.')
"
```

**ì—ì…‹ ì¢…ì†ì„± í™•ì¸:**

```bash
python -c "
from dag.definitions import defs
from dagster import AssetKey

asset_graph = defs.get_asset_graph()
ds_assets = ['ds_img_r2_docker', 'ds_img_r2_node', 'ds_img_r2_processing']

for asset_name in ds_assets:
    asset_key = AssetKey([asset_name])
    if asset_key in asset_graph.all_asset_keys:
        deps = asset_graph.get_upstream_asset_keys(asset_key)
        print(f'{asset_name} depends on: {[dep.to_user_string() for dep in deps]}')
"
```

## ìŠ¤í† ë¦¬ì§€

-   **ì¤‘ê°„ ìŠ¤í† ë¦¬ì§€**: ìŠ¤í¬ë©ëœ ì›ì‹œ ë°ì´í„°ëŠ” í¬ë¡¤ëŸ¬ê°€ ì‹¤í–‰ë˜ëŠ” ë¡œì»¬ íŒŒì¼ ì‹œìŠ¤í…œì— JSON íŒŒì¼ë¡œ ì„ì‹œ ì €ì¥ë©ë‹ˆë‹¤.
-   **ì˜êµ¬ ìŠ¤í† ë¦¬ì§€**: ìµœì¢… ì²˜ë¦¬ëœ ë°ì´í„° ë°/ì´ë¯¸ì§€ëŠ” ì¥ê¸°ì ì¸ ì§€ì†ì„± ë° ë‹¤ìš´ìŠ¤íŠ¸ë¦¼ ì‚¬ìš©ì„ ìœ„í•´ Cloudflare R2 ë²„í‚·ì— ì €ì¥ë©ë‹ˆë‹¤.

```